# טופס עדכון פרטי אשראי - חיבור לגוגל שיטס

פרויקט זה מאפשר לטופס לטעון נתונים אוטומטית מגוגל שיטס על פי תעודת זהות.

## תכונות

- טעינת נתונים אוטומטית מגוגל שיטס לפי תעודת זהות
- מילוי אוטומטי של כל שדות הטופס
- תמיכה בנתוני החבר, בן/בת הזוג ופרטי אשראי
- ממשק משתמש ידידותי עם הודעות שגיאה והצלחה

## קבצים בפרויקט

- `טופס_עדכון_פרטי_אשראי.html` - קובץ הטופס הראשי
- `js/google-sheets-loader.js` - ספריית JavaScript לטעינת נתונים מגוגל שיטס
- `google-apps-script.js` - קוד Google Apps Script לפרסום כ-Web App

## הוראות התקנה והגדרה

### שלב 1: יצירת גוגל שיטס

1. פתח [Google Sheets](https://sheets.google.com)
2. צור גיליון חדש או פתח גיליון קיים
3. ודא שהשורה הראשונה מכילה כותרות (headers)
4. ודא שיש עמודה עם תעודות זהות (מומלץ בעמודה A)

**דוגמה למבנה הגיליון:**

| מס זהות | שם משפחה | שם פרטי | ישוב | רחוב | מס בית | מס דירה | מיקוד | שנת לידה | טלפון |
|---------|----------|---------|------|------|--------|---------|-------|----------|-------|
| 123456789 | כהן | דוד | תל אביב | הרצל | 10 | 5 | 12345 | 1980 | 050-1234567 |

**הערה:** הכותרות צריכות להיות בשורה הראשונה של הגיליון. המערכת תתאים אוטומטית בין הכותרות לשדות הטופס.

### שלב 2: יצירת Google Apps Script

1. בגוגל שיטס, לחץ על **Extensions** > **Apps Script**
2. מחק את הקוד הקיים והדבק את התוכן מקובץ `google-apps-script.js`
3. עדכן את ההגדרות הבאות בקוד:
   ```javascript
   const SPREADSHEET_ID = 'YOUR_SPREADSHEET_ID_HERE';
   const SHEET_NAME = 'Sheet1'; // או שם הגיליון שלך
   const ID_COLUMN = 'A'; // עמודת תעודת זהות
   ```
4. כדי למצוא את `SPREADSHEET_ID`:
   - פתח את הגיליון שלך
   - הסתכל על ה-URL: `https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit`
   - העתק את החלק בין `/d/` ל-`/edit`
5. לחץ על **Save** (Ctrl+S) ושמור את הפרויקט

### שלב 3: פרסום כ-Web App

1. ב-Apps Script, לחץ על **Deploy** > **New deployment**
2. לחץ על האייקון ⚙️ ליד **Select type** ובחר **Web app**
3. הגדר:
   - **Description**: "טעינת נתונים לטופס" (או כל תיאור אחר)
   - **Execute as**: **Me**
   - **Who has access**: **Anyone**
4. לחץ על **Deploy**
5. **חשוב**: העתק את ה-URL שמופיע (נראה כמו: `https://script.google.com/macros/s/...`)
6. לחץ על **Authorize access** והרשא את הסקריפט לגשת לגיליון שלך

### שלב 4: עדכון קובץ HTML

1. פתח את קובץ `טופס_עדכון_פרטי_אשראי.html`
2. מצא את השורה:
   ```javascript
   const GOOGLE_APPS_SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';
   ```
3. החלף את `YOUR_GOOGLE_APPS_SCRIPT_URL_HERE` ב-URL שהעתקת בשלב 3
4. שמור את הקובץ

### שלב 5: בדיקה

1. פתח את קובץ ה-HTML בדפדפן
2. הזן מספר תעודת זהות בשדה "תעודת זהות"
3. לחץ על כפתור **"טען מגוגל שיטס"**
4. השדות אמורים להתמלא אוטומטית

## שימוש

### שיטה 1: טעינה דרך URL (מומלץ)
פתח את הטופס עם מספר זהות ב-URL:
```
טופס_עדכון_פרטי_אשראי.html?id=123456789
```

הטופס יטען אוטומטית את הנתונים מהגוגל שיטס וימלא את כל השדות.

**דוגמאות:**
- `טופס_עדכון_פרטי_אשראי.html?id=123456789`
- `טופס_עדכון_פרטי_אשראי.html?id=987654321`

### שיטה 2: כפתור ידני
1. הזן תעודת זהות בשדה "תעודת זהות"
2. לחץ על **"טען מגוגל שיטס"**

### שיטה 3: טעינה אוטומטית עם Enter
- הזן תעודת זהות ולחץ **Enter** - הטופס יטען את הנתונים אוטומטית

## מיפוי שדות

המערכת ממפה אוטומטית בין כותרות הגיליון לשדות הטופס. מיפוי ברירת מחדל:

### שדות החבר:
- `מס זהות` / `תעודת זהות` / `ת.ז.` → שדה תעודת זהות
- `שם משפחה` → שם משפחה
- `שם פרטי` → שם פרטי
- `שנת לידה` → שנת לידה
- `ישוב` / `עיר` → עיר
- `רחוב` → רחוב
- `מס בית` / `מספר בית` → מספר בית
- `מס דירה` → מספר דירה (לא קיים בטופס, נשמר בנתונים)
- `מיקוד` → מיקוד (לא קיים בטופס, נשמר בנתונים)
- `טלפון` / `טלפון נייד` → טלפון נייד
- `אימייל` / `דואר אלקטרוני` → דואר אלקטרוני
- `שם האב` → שם האב

**הערה:** שדות נוספים כמו `קוד תשלום`, `ת.הצטרפות`, `סניף`, `פעיל` וכו' נטענים אך לא מופיעים בטופס הנוכחי. ניתן להוסיף אותם לטופס בעתיד.

### שדות בן/בת הזוג:
- `תעודת זהות בן זוג` / `ת.ז. בן זוג` → תעודת זהות בת/בן זוג
- `שם משפחה בן זוג` → שם משפחה בת/בן זוג
- `שם פרטי בן זוג` → שם פרטי בת/בן זוג
- `שנת לידה בן זוג` → שנת לידה בת/בן זוג
- `שם האב בן זוג` → שם האב בת/בן זוג
- `טלפון בן זוג` → טלפון נייד בת/בן זוג
- `אימייל בן זוג` → דואר אלקטרוני בת/בן זוג

### שדות אשראי:
- `מספר אשראי` → מספר אשראי
- `תוקף אשראי` → תוקף אשראי
- `שם בעל הכרטיס` → שם בעל הכרטיס
- `תעודת זהות בעל הכרטיס` → תעודת זהות בעל הכרטיס

## פתרון בעיות

### הכפתור לא מופיע
- ודא שהגדרת את `GOOGLE_APPS_SCRIPT_URL` בקובץ HTML
- בדוק את קונסולת הדפדפן (F12) לשגיאות

### "לא נמצאו נתונים"
- ודא שתעודת הזהות קיימת בגיליון
- ודא שהעמודה הראשונה (או העמודה שצוינה ב-`ID_COLUMN`) מכילה את תעודות הזהות
- ודא שאין רווחים מיותרים בתעודת הזהות

### "שגיאה בטעינת נתונים"
- ודא שה-Apps Script מפורסם כ-Web App
- ודא שהרשאת גישה ל-Anyone
- בדוק את ה-URL שהוגדר בקובץ HTML
- בדוק את לוגי Apps Script (View > Logs)

### שדות לא מתמלאים
- ודא ששמות הכותרות בגיליון תואמים למיפוי (ראה סעיף "מיפוי שדות")
- בדוק שהנתונים קיימים בגיליון
- ודא שאין שגיאות בקונסולת הדפדפן

## אבטחה

- **חשוב**: ה-Apps Script צריך להיות מוגדר ל-**Anyone** כדי לעבוד מהדפדפן
- אם יש לך נתונים רגישים, שקול להוסיף אימות נוסף ב-Apps Script
- אל תחלוק את ה-URL של ה-Apps Script בפומבי

## תמיכה

לשאלות או בעיות, בדוק:
1. את קונסולת הדפדפן (F12 > Console)
2. את לוגי Apps Script (View > Logs)
3. את מבנה הגיליון והנתונים

## רישיון

פרויקט זה נוצר לשימוש פנימי.
